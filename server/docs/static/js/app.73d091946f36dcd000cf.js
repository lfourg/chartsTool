webpackJsonp([1],{"+To7":function(t,e){},"/wAz":function(t,e){},"34SS":function(t,e){},"4/hK":function(t,e){},"4L0j":function(t,e){},"8/9v":function(t,e){},"8idx":function(t,e){},"991W":function(t,e){},"9xLI":function(t,e){},BTHh:function(t,e){},GfIb:function(t,e){},"Gp/Q":function(t,e){},INaB:function(t,e){},KwuY:function(t,e){},LYuF:function(t,e){},MPuT:function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("mvHQ"),n=i.n(s),a=i("7+uW"),r=i("Dd8w"),o=i.n(r),c=i("NYxO"),l={formatDate:function(t,e){/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length)));var i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds()};for(var s in i)if(new RegExp("("+s+")").test(e)){var n=i[s]+"";e=e.replace(RegExp.$1,1===RegExp.$1.length?n:u(n))}return e},setChartTypes:function(t){this.api.post("/chartType/find",{}).then(function(e){e.status&&t.$store.dispatch("setTypes",e.result)})},setProjects:function(t,e){var i={pageSize:1e3,userId:e._id};t.api.post("/project/findByUser",i).then(function(e){e.status&&t.$store.dispatch("setProjects",e.result)})},getUrlData:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null},setLoginStore:function(t,e){t.$store.dispatch("setMenus",!0),t.$store.dispatch("setLoginDialogState",!1),t.$store.dispatch("setUser",e),this.setProjects(t,e)},message:function(t,e,i){t.$message({showClose:!0,message:i,type:e})}};function u(t){return("00"+t).substr(t.length)}var d={name:"login",data:function(){return{flag:1,user:{name:"",pwd:""},error:{msg:"",show:!1}}},mounted:function(){},methods:{login:function(){var t=this;if(!this.user.name||!this.user.pwd)return this.error={msg:"用户名或密码不能为空",show:!0},void this.closeAlert();this.api.post("/user/find",this.user).then(function(e){console.log("user:",e),e.result?(localStorage.setItem("currUser",n()(e.result)),l.setLoginStore(t,e.result)):(t.error={msg:"用户名或密码错误",show:!0},t.closeAlert())})},change:function(){this.flag=!this.flag},closeAlert:function(){var t=this;setTimeout(function(){t.error.show=!1},1500)},closeLogin:function(){this.$store.dispatch("setLoginDialogState",!1),this.$store.dispatch("setProjects",[])},githubClick:function(){window.location.href="https://github.com/login/oauth/authorize?client_id=263f45ba8ea1fb856276&redirect_uri="+window.location.href}}},h={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"block-login-wrap"},[t._m(0),t._v(" "),i("transition",{attrs:{name:"slide-fade"}},[t.flag?i("div",{staticClass:"login-con"},[i("div",{staticClass:"login-choose"},[i("span",[t._v("请选择快捷登录方式")])]),t._v(" "),i("div",{staticClass:"login-div"},[i("ul",{staticClass:"clearfix"},[i("li",[i("a",{on:{click:t.githubClick}},[i("i",{staticClass:"icon iconfont icon-github"})])]),t._v(" "),i("li",[i("a",{attrs:{title:"暂不支持"}},[i("i",{staticClass:"icon iconfont icon-qqfuben"})])])])])]):t._e()]),t._v(" "),i("transition",{attrs:{name:"slide-fade"}},[t.flag?t._e():i("div",{staticClass:"login-con"},[i("el-form",{attrs:{model:t.user,"label-width":"80px",size:"small"}},[i("el-form-item",{attrs:{label:"用户名"}},[i("el-input",{staticClass:"inp",model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"密码"}},[i("div",{staticClass:"inp el-input el-input--small"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.user.pwd,expression:"user.pwd"}],staticClass:"el-input__inner",attrs:{type:"password"},domProps:{value:t.user.pwd},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.login(e):null},input:function(e){e.target.composing||t.$set(t.user,"pwd",e.target.value)}}})])]),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.login}},[t._v("登录")]),t._v(" "),i("el-button",{on:{click:t.closeLogin}},[t._v("关闭")])],1)],1),t._v(" "),i("transition",{attrs:{name:"slide-fade-error"}},[t.error.show?i("el-alert",{attrs:{title:t.error.msg,type:"error",closable:!1,"show-icon":""}}):t._e()],1)],1)]),t._v(" "),i("div",{staticClass:"login-model"},[i("span",{on:{click:t.change}},[t._v(t._s(t.flag?"切换用户登录":"切换快捷登录"))])])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"login-top"},[e("span",{staticClass:"item",staticStyle:{"margin-top":"0"}},[e("i",{staticClass:"icon iconfont icon-icp-acitve-spline"})]),this._v(" "),e("span",{staticClass:"item"},[this._v("charts")])])}]};var p=i("VU/8")(d,h,!1,function(t){i("MPuT")},"data-v-5f007c1a",null).exports,m={name:"app",data:function(){return{}},computed:o()({},Object(c.b)({loginDialogState:"getIsShowLoginDialog"})),components:{LoginDialog:p},mounted:function(){this.init()},methods:{init:function(){},close:function(){this.$store.dispatch("setLoginDialogState",!1)}}},f={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[i("router-view"),t._v(" "),i("div",{staticClass:"login-dialog"},[i("el-dialog",{attrs:{visible:t.loginDialogState,width:"320px","append-to-body":!0,"lock-scroll":!1},on:{"update:visible":function(e){t.loginDialogState=e},close:t.close}},[i("LoginDialog")],1)],1)],1)},staticRenderFns:[]};var v=i("VU/8")(m,f,!1,function(t){i("BTHh")},"data-v-1bbc50ff",null).exports,g=i("/ocq"),_={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"content"},[e("router-view")],1)])},staticRenderFns:[]};var b=i("VU/8")({name:"pageApp",data:function(){return{}},computed:{},components:{},methods:{}},_,!1,function(t){i("Gp/Q")},"data-v-735373ae",null).exports,C={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"con"},[e("iframe",{attrs:{src:"https://zhu18.github.io/visualcontrols/#/map3d/debug",frameborder:"0",width:"100%",height:"100%;"}})])}]};i("VU/8")({name:"index",data:function(){return{}},components:{},created:function(){},mounted:function(){this.init()},methods:{init:function(){this.$store.dispatch("setCurrMenu",{flag:"index"})}}},C,!1,function(t){i("bF7+")},"data-v-11c3cc0e",null).exports;var y=i("Gu7T"),w=i.n(y),x=i("HMpe"),k={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("input",{directives:[{name:"model",rawName:"v-model",value:t.key,expression:"key"}],attrs:{type:"text",placeholder:"请输入查询条件"},domProps:{value:t.key},on:{keyup:function(e){return"button"in e||!t._k(e.keyCode,"enter",13,e.key,"Enter")?t.search(e):null},input:function(e){e.target.composing||(t.key=e.target.value)}}}),i("i",{staticClass:"icon iconfont icon-search",on:{click:t.search}})])},staticRenderFns:[]};var j=i("VU/8")({name:"search",data:function(){return{key:""}},methods:{search:function(){this.key&&this.$router.push({path:"/chart/search",query:{q:this.key}})}}},k,!1,function(t){i("34SS")},"data-v-0b57ed5e",null).exports,$=i("KiQM"),I=i.n($),P={name:"HeaderBar",props:["chartPage"],computed:o()({},Object(c.b)({currMenu:"getCurrMenu",menus:"getMenus",isLogin:"getIsLogin",user:"getUser"})),components:{Search:j},data:function(){return{iconBase64:"",iconOptions:{foreground:[255,255,255],background:[70,77,81],margin:.2,size:25,format:"svg"}}},mounted:function(){this.init()},methods:{init:function(){this.setIcon()},add:function(){this.isLogin?this.$emit("handleAdd"):this.$store.dispatch("setLoginDialogState",!0)},setIcon:function(){if(this.isLogin&&this.user._id){var t=new I.a(this.user._id,this.iconOptions).toString();this.iconBase64="data:image/svg+xml;base64,"+t}},login:function(){this.$store.dispatch("setLoginDialogState",!0)},exit:function(){localStorage.removeItem("currUser"),this.$router.push("/"),this.$store.dispatch("setMenus",!1),this.$store.dispatch("setUser",null)}},watch:{isLogin:function(){this.setIcon()}}},S={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"navbar"},[i("div",{staticClass:"logo"},[i("router-link",{attrs:{to:"/"}},[i("i",{staticClass:"icon iconfont icon-icp-acitve-spline"}),i("span",[t._v("charts")])])],1),t._v(" "),i("ul",t._l(t.menus,function(e){return i("li",{class:[e.flag==t.currMenu.flag?"active":""]},[i("router-link",{attrs:{to:e.url}},[i("i",{class:["icon","iconfont",e.icon]}),t._v(t._s(e.name))])],1)})),t._v(" "),i("div",{staticClass:"block-bar-right"},[i("div",{staticClass:"search"},[i("Search")],1),t._v(" "),i("div",{staticClass:"operation"},[t.isLogin?i("div",{staticClass:"com-item user"},[i("img",{staticClass:"my-icon",attrs:{src:t.iconBase64}}),t._v(" "),i("i",{staticClass:"icon iconfont icon-sanjiaoxing-down"}),t._v(" "),i("div",{staticClass:"item"},[i("div",{staticClass:"chi-item"},[i("router-link",{attrs:{to:"/user"}},[i("i",{staticClass:"icon iconfont icon-user"}),t._v("个人中心")])],1),t._v(" "),i("div",{staticClass:"chi-item",on:{click:t.exit}},[t._m(0)])])]):i("div",{staticClass:"com-item user"},[i("a",{on:{click:t.login}},[t._v("登录")])]),t._v(" "),t.chartPage?i("div",{staticClass:"com-item add-chart"},[i("a",{on:{click:t.add}},[i("i",{staticClass:"icon iconfont icon-tianjia2"}),t._v("新增")])]):t._e()])])])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("a",[e("i",{staticClass:"icon iconfont icon-tuichu2"}),this._v("退出")])}]};var F=i("VU/8")(P,S,!1,function(t){i("8/9v")},"data-v-ebac113c",null).exports,L=i("162o"),T={name:"indexList",props:["charts","isChange"],data:function(){return{imgs:[],options:{foreground:[255,255,255],background:[55,61,65],margin:.2,size:25,format:"svg"}}},computed:o()({},Object(c.b)({user:"getUser",isLogin:"getIsLogin"})),mounted:function(){},methods:{lazyImg:function(t){var e=this;this.imgs.push(t),Object(L.setTimeout)(function(){e.loadImgs()}),window.onscroll=function(){return e.loadImgs()}},loadImgs:function(){var t=this,e=window.scrollY,i=window.innerHeight,s=void 0;this.imgs.map(function(n,a){if(n){var r=n.getBoundingClientRect(),o=n.ownerDocument.defaultView;s=r.top+o.pageYOffset-e,(n.offsetWidth||n.offsetHeight||n.getClientRects().length)&&s>=0&&s<i&&(t.setBase64(n),t.imgs[a]=null)}})},setBase64:function(t){this.api.get("/chart/getBase64",{id:t.getAttribute("id")}).then(function(e){t.className+=" loaded",e.status&&e.result.base64?t.src=e.result.base64:t.src="/static/default.png"})},detail:function(t){window.open("/detail/"+t)},edit:function(t){this.$emit("editChart",t)},del:function(t){var e=this;this.$confirm("此操作将永久删除该图表, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.api.post("/chart/del",{_id:t}).then(function(t){e.$message({showClose:!0,message:t.status?"删除成功":"删除失败",type:t.status?"success":"error"}),t.status&&e.$emit("delChart",!0)})}).catch(function(){})},search:function(t){this.$router.push({path:"/chart/search",query:{u:t._id}})},getIcon:function(t){return"data:image/svg+xml;base64,"+new I.a(t._id,this.options).toString()},getDateDiff:function(t){"string"==typeof t&&(t=this.getDate(t));var e=(new Date).getTime()-t,i=e/2592e6,s=e/6048e5,n=e/864e5,a=e/36e5,r=e/6e4;return i>=1?parseInt(i)+"个月前":s>=1?parseInt(s)+"周前":n>=1?parseInt(n)+"天前":a>=1?parseInt(a)+"个小时前":r>=1?parseInt(r)+"分钟前":"刚刚"},getDate:function(t){var e=t.toString();return e=(e=e.replace("/-/g","/")).replace("T"," "),new Date(e).getTime()}},watch:{isChange:function(){this.imgs=[]}},directives:{lazy:{bind:function(t,e){e.value(t)}}}},E={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.charts.length>0?i("div",{ref:"div"},t._l(t.charts,function(e){return e.user?i("div",{staticClass:"chartItem"},[i("div",{staticClass:"img",on:{click:function(i){t.detail(e._id)}}},[i("img",{directives:[{name:"lazy",rawName:"v-lazy",value:t.lazyImg,expression:"lazyImg"}],ref:e._id,refInFor:!0,staticClass:"lazy",attrs:{id:e._id}})]),t._v(" "),i("div",{staticClass:"ctx"},[i("h3",[i("a",{attrs:{title:e.name},on:{click:function(i){t.detail(e._id)}}},[t._v(t._s(e.name))])]),t._v(" "),i("span",{staticClass:"item user",attrs:{title:e.user.disName||e.user.name},on:{click:function(i){i.stopPropagation(),t.search(e.user)}}},[i("img",{attrs:{width:"25",height:"25",src:t.getIcon(e.user)}}),t._v(" "+t._s(e.user.disName||e.user.name))]),t._v(" "),i("span",{staticClass:"item date",attrs:{title:e.createDate}},[t._v(t._s(t.getDateDiff(e.updateDate)))])]),t._v(" "),i("div",{staticClass:"y-border"}),t._v(" "),t.isLogin&&(t.user.superAdmin||e.user._id==t.user._id||e.project&&t.user._id==e.project.manager)?[i("div",{staticClass:"op edit edit-active",on:{click:function(i){i.stopPropagation(),t.edit(e)}}},[t._v("编辑")]),t._v(" "),i("div",{staticClass:"op cls cls-active",on:{click:function(i){i.stopPropagation(),t.del(e._id)}}},[t._v("删除")])]:[i("div",{staticClass:"op edit",attrs:{title:"无操作权限"}},[t._v("编辑")]),t._v(" "),i("div",{staticClass:"op cls",attrs:{title:"无操作权限"}},[t._v("删除")])]],2):t._e()})):t._e()},staticRenderFns:[]};var U=i("VU/8")(T,E,!1,function(t){i("INaB")},"data-v-9971e048",null).exports,D={name:"add",props:["proItem"],computed:o()({},Object(c.b)({user:"getUser"})),data:function(){return{popover:{v1:!1,v2:!1}}},mounted:function(){},methods:{save:function(){var t=this;if(this.proItem.name?this.proItem||(this.popover.v2=!0):this.popover.v1=!0,this.initPopover(),!this.popover.v1&&!this.popover.v2){var e=!this.proItem._id;e&&(this.proItem.manager=this.user),this.api.post(e?"/project/add":"/project/edit",this.proItem).then(function(e){t.$message({showClose:!0,message:e.status?"操作成功":"操作失败",type:e.status?"success":"error"}),e.status&&t.$emit("reloadProject",!0)})}},close:function(){this.$emit("reloadProject")},initPopover:function(){var t=this;setTimeout(function(){t.popover.v1=!1,t.popover.v2=!1},2e3)}}},R={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{ref:"proItem",attrs:{model:t.proItem,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"名称"}},[i("el-popover",{ref:"popover1",attrs:{placement:"top-start",trigger:"manual"},model:{value:t.popover.v1,callback:function(e){t.$set(t.popover,"v1",e)},expression:"popover.v1"}},[i("p",[t._v("请输入名称")])]),t._v(" "),i("el-input",{directives:[{name:"popover",rawName:"v-popover:popover1",arg:"popover1"}],model:{value:t.proItem.name,callback:function(e){t.$set(t.proItem,"name",e)},expression:"proItem.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.proItem.remark,callback:function(e){t.$set(t.proItem,"remark",e)},expression:"proItem.remark"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),i("el-button",{on:{click:t.close}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var B=i("VU/8")(D,R,!1,function(t){i("LYuF")},"data-v-610d580f",null).exports,M={name:"add",props:["chartTypes","chart"],data:function(){return{popover:{v1:!1,v2:!1}}},computed:o()({},Object(c.b)({user:"getUser",isLogin:"getIsLogin",projects:"getProjects"})),mounted:function(){console.log("chart:",this.chart)},methods:{save:function(){var t=this;if(this.chart.name?this.chart.project||(this.popover.v2=!0):this.popover.v1=!0,this.initPopover(),!this.popover.v1&&!this.popover.v2){var e=!this.chart._id;e&&(this.chart.user=this.user._id),this.api.post(e?"/chart/add":"/chart/update",this.chart).then(function(e){t.$message({showClose:!0,message:e.status?"操作成功":"操作失败",type:e.status?"success":"error"}),e.status&&t.$emit("reloadCharts",!0)})}},close:function(){this.$emit("reloadCharts")},selChartType:function(t){this.chart.chartType=t},initPopover:function(){var t=this;Object(L.setTimeout)(function(){t.popover.v1=!1,t.popover.v2=!1},2e3)},addPro:function(){this.$emit("addPro")}}},z={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-form",{ref:"chart",attrs:{model:t.chart,"label-width":"80px"}},[i("el-form-item",{attrs:{label:"名称"}},[i("el-popover",{ref:"popover1",attrs:{placement:"top-start",trigger:"manual"},model:{value:t.popover.v1,callback:function(e){t.$set(t.popover,"v1",e)},expression:"popover.v1"}},[i("p",[t._v("请输入名称")])]),t._v(" "),i("el-input",{directives:[{name:"popover",rawName:"v-popover:popover1",arg:"popover1"}],attrs:{placeholder:"名称-特性(eg:渐变、双轴..)"},model:{value:t.chart.name,callback:function(e){t.$set(t.chart,"name",e)},expression:"chart.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"项目"}},[i("el-popover",{ref:"popover2",attrs:{placement:"top-start",trigger:"manual"},model:{value:t.popover.v2,callback:function(e){t.$set(t.popover,"v2",e)},expression:"popover.v2"}},[i("p",[t._v("请选择项目")])]),t._v(" "),i("el-select",{directives:[{name:"popover",rawName:"v-popover:popover2",arg:"popover2"}],attrs:{filterable:"",placeholder:"请选择所属项目"},model:{value:t.chart.project,callback:function(e){t.$set(t.chart,"project",e)},expression:"chart.project"}},t._l(t.projects,function(t){return i("el-option",{key:t._id,attrs:{label:t.name,value:t._id}})})),t._v(" "),i("span",{staticClass:"add-pro",attrs:{title:"添加项目"},on:{click:t.addPro}},[i("i",{staticClass:"icon iconfont icon-addfile"})])],1),t._v(" "),i("el-form-item",{attrs:{label:"模板"}},[i("el-radio-group",{model:{value:t.chart.category,callback:function(e){t.$set(t.chart,"category",e)},expression:"chart.category"}},[i("el-radio",{attrs:{label:"Echarts"}}),t._v(" "),i("el-radio",{attrs:{label:"D3"}}),t._v(" "),i("el-radio",{attrs:{label:"ThreeJS"}})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"类型"}},[i("div",{staticClass:"chartTypes"},t._l(t.chartTypes,function(e){return i("span",{class:["item",e._id==t.chart.chartType?"active":""],on:{click:function(i){t.selChartType(e._id)}}},[i("i",{class:["icon","iconfont",e.icon]}),i("label",[t._v(t._s(e.name))])])}))]),t._v(" "),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.chart.remark,callback:function(e){t.$set(t.chart,"remark",e)},expression:"chart.remark"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")]),t._v(" "),i("el-button",{on:{click:t.close}},[t._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var A=i("VU/8")(M,z,!1,function(t){i("+To7")},"data-v-5f6b5578",null).exports,V=i("zL8q"),N=i.n(V),O=i("Y81h"),q=i.n(O),H={name:"index",data:function(){return{loading:!1,isChange:!0,search:{noResult:!1},proItem:{name:"",remark:""},nav:{isShow:!0,type:"type",chartTypes:[],items:[]},curr:{navId:"",typeId:"",proId:"",chart:{},charts:[]},chartCount:{type:[],project:[]},dialog:{visible:!1,title:""},dialogPro:{visible:!1,title:"添加项目"},pagination:{scrollDisable:!1,size:50,index:0,total:0}}},computed:o()({},Object(c.b)({user:"getUser",projects:"getProjects"})),components:{ChartList:U,AddChart:A,HeaderBar:F,AddProject:B},mounted:function(){q.a.start(),q.a.configure({easing:"linear",trickleSpeed:100}),this.nav.type=this.$route.params.type||"type",this.$store.dispatch("setCurrMenu",{flag:"chart"+this.nav.type});new x.a("#container",{wheelSpeed:.5});this.init(),this.scrollEvent()},methods:{init:function(){"search"==this.nav.type&&(this.nav.isShow=!1,this.getCharts()),this.getChartCountByType(),this.getChartTypes(),this.getProjects(),this.getChartCountByProject()},scrollEvent:function(){var t=this;window.addEventListener("scroll",function(){document.documentElement.scrollTop+window.innerHeight>=document.body.offsetHeight&&(t.pagination.scrollDisable||(t.pagination.scrollDisable=!0,t.pagination.index++,t.loadCharts()))})},showAni:function(){var t=this;Object(L.setTimeout)(function(){t.nav.acitve=!0,(new TimelineMax).staggerFrom(".projectItem",.2,{x:-300,opacity:.3,ease:Back.easeOut},.1)})},getProjects:function(){this.projects.length>0&&(this.curr.proId=this.projects[0]._id,"pro"==this.nav.type&&(this.nav.items=this.projects,this.getCharts()))},getChartTypes:function(){var t=this;this.api.post("/chartType/find",{}).then(function(e){e.status&&(t.nav.chartTypes=e.result,t.curr.typeId=t.nav.chartTypes[0]._id,"type"==t.nav.type&&(t.nav.items=t.nav.chartTypes,t.getCharts()))})},getChartCountByProject:function(){var t=this;this.api.get("/project/chartCount",{}).then(function(e){e.status&&(t.chartCount.project=e.result)})},getChartCountByType:function(){var t=this;this.api.get("/chart/countByType",{}).then(function(e){e.status&&(t.chartCount.type=e.result)})},getChartCount:function(t){var e=void 0,i="type"==this.nav.type?"type":"project";return this.chartCount[i].some(function(i,s){if(i._id==t)return e=i,!0}),e?e.count:"0"},getCharts:function(t){t?(this.curr.navId=t,this.curr["pro"==this.nav.type?"proId":"typeId"]=t):this.curr.navId=this.curr["pro"==this.nav.type?"proId":"typeId"],this.pagination.total=this.getChartCount(this.curr.navId);this.getSearchParam();this.curr.charts=[],this.pagination.index=0,this.pagination.scrollDisable=!1,this.isChange=!this.isChange,this.loadCharts()},getSearchParam:function(){var t=this.$route.query;return"pro"==this.nav.type?{project:this.curr.proId}:"type"==this.nav.type?{chartType:this.curr.typeId}:t.u?{user:t.u}:{keyword:t.q||""}},loadCharts:function(){var t=this;q.a.start();var e=this.getSearchParam(),i={pageIndex:this.pagination.index,pageSize:this.pagination.size,chart:e};this.api.post("/chart/find",i).then(function(i){var s;i.status&&((s=t.curr.charts).push.apply(s,w()(i.result)),e.keyword&&0==i.result.length?t.search.noResult=!0:t.search.noResult=!1);(t.pagination.index+1)*t.pagination.size<t.pagination.total?t.pagination.scrollDisable=!1:t.pagination.scrollDisable=!0,q.a.set(.99),Object(L.setTimeout)(function(){q.a.done()},100)})},addChart:function(){this.reset(),this.dialog.title="添加图表",this.dialog.visible=!0},editChart:function(t){this.curr.chart={_id:t._id,name:t.name,project:t.project._id,category:t.category,chartType:t.chartType,remark:t.remark},this.dialog.title="编辑图表",this.dialog.visible=!0},addPro:function(){this.dialogPro.visible=!0},reloadPros:function(t){var e=this;this.dialogPro.visible=!1,t&&(l.setProjects(this,this.user),Object(L.setTimeout)(function(){e.projects&&e.projects.length>0&&(e.curr.chart.project=e.projects[0]._id)},1e3))},reloadCharts:function(t){this.dialog.visible=!1,t&&(this.getCharts(),this.getChartCountByType(),this.getChartCountByProject())},reset:function(){this.curr.chart={name:"",project:this.curr.proId,category:"Echarts",chartType:this.curr.typeId,remark:""}}},watch:{$route:function(){this.nav.type=this.$route.params.type||"type",this.nav.items="pro"==this.nav.type?this.projects:this.nav.chartTypes,this.nav.isShow="search"!=this.nav.type,this.$store.dispatch("setCurrMenu",{flag:"chart"+this.nav.type}),this.getCharts()},projects:function(){this.getProjects()},"nav.items":function(){var t=document.querySelector("#container");t&&(t.scrollTop=0)}}},Y={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("HeaderBar",{attrs:{chartPage:"true"},on:{handleAdd:t.addChart}}),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{"element-loading-text":"拼命加载中...."}},[t.nav.isShow?i("div",{class:["navigation"],attrs:{id:"container"}},t._l(t.nav.items,function(e){return i("a",{class:["projectItem",e._id==t.curr.navId?"active":""],attrs:{title:e.name},on:{click:function(i){t.getCharts(e._id)}}},["type"==t.nav.type?i("i",{class:["icon","iconfont",e.icon]}):t._e(),t._v(t._s(e.name)+" ("+t._s(t.getChartCount(e._id))+")\n      ")])})):t._e(),t._v(" "),i("div",{class:["right-container clearfix",t.nav.isShow?"mar-left180":""]},[i("div",{class:["noresult",t.search.noResult?"noresult-active":""]},[t._v("没找到名称为“"+t._s(t.$route.query.q)+"”的图表")]),t._v(" "),i("ChartList",{attrs:{charts:t.curr.charts,isChange:t.isChange},on:{editChart:t.editChart,delChart:t.reloadCharts}})],1)]),t._v(" "),i("el-dialog",{attrs:{title:t.dialog.title,visible:t.dialog.visible,width:"60%","lock-scroll":!1},on:{"update:visible":function(e){t.$set(t.dialog,"visible",e)}}},[i("AddChart",{attrs:{chartTypes:t.nav.chartTypes,chart:t.curr.chart},on:{addPro:t.addPro,reloadCharts:t.reloadCharts}})],1),t._v(" "),i("el-dialog",{attrs:{title:t.dialogPro.title,visible:t.dialogPro.visible,width:"40%","lock-scroll":!1},on:{"update:visible":function(e){t.$set(t.dialogPro,"visible",e)}}},[i("AddProject",{attrs:{proItem:t.proItem},on:{reloadProject:t.reloadPros}})],1)],1)},staticRenderFns:[]};var K=i("VU/8")(H,Y,!1,function(t){i("qpBq")},"data-v-4eef8f84",null).exports,G=i("E5Az"),W=i.n(G),Q=(i("4/hK"),i("aX1R"),i("Kk9m"),i("fo6W"),i("Yokd"),i("aGTD"),i("5IAE"),i("8Nur"),i("hKnC"),i("9xLI"),i("PsxY"),i("jQeI"),i("Mixr"),i("iVNi"),i("aYBQ")),J=i.n(Q),X={name:"HeaderBar",props:["options"],data:function(){return{iconBase64:"",isEditTitle:!1,iconOptions:{foreground:[255,255,255],background:[70,77,81],margin:.2,size:20,format:"svg"}}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){this.setIcon()},methods:{save:function(){this.$emit("handleCli")},setIcon:function(){if(this.options&&this.options.id){var t=new I.a(this.options.id,this.iconOptions).toString();this.iconBase64="data:image/svg+xml;base64,"+t}},edit:function(t){this.isEditTitle=t,t&&setTimeout(function(){document.getElementById("title").focus()})}},watch:{"options.id":function(){this.setIcon()}}},Z={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"navbar"},[i("div",{staticClass:"logo"},[i("router-link",{attrs:{to:"/"}},[i("i",{staticClass:"icon iconfont icon-icp-acitve-spline"})])],1),t._v(" "),i("div",{staticClass:"base"},[i("div",{staticClass:"title"},[t.isEditTitle?i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.options.title,expression:"options.title"}],attrs:{type:"text",id:"title"},domProps:{value:t.options.title},on:{blur:function(e){t.edit(!1)},input:function(e){e.target.composing||t.$set(t.options,"title",e.target.value)}}})]):i("div",[i("label",[t._v(t._s(t.options.title))]),t.user.superAdmin||t.options.isShowPublish?i("i",{staticClass:"icon iconfont icon-23",attrs:{title:"编辑"},on:{click:function(e){t.edit(!0)}}}):t._e()])]),t._v(" "),i("div",{staticClass:"create"},[i("img",{attrs:{src:t.iconBase64}}),t._v(t._s(t.options.disName))])]),t._v(" "),i("div",{staticClass:"operate"},[t.user.superAdmin||t.options.isShowPublish?i("a",{staticClass:"publish",on:{click:t.save}},[i("i",{staticClass:"icon iconfont icon-fabu"}),t._v("发布")]):t._e()])])},staticRenderFns:[]};var tt=i("VU/8")(X,Z,!1,function(t){i("b72d")},"data-v-9fce8e00",null).exports,et=i("7nRM"),it=i.n(et),st={name:"uploadResource",props:["chart","fileList"],data:function(){return{files:[]}},mounted:function(){var t=it()(this.fileList);this.files=t.slice(0)},methods:{uploadSuccess:function(t,e,i){t.status&&this.$emit("upFiles",t.result)},uploadError:function(t,e,i){},beforeAvatarUpload:function(t){return!t||t.size/1024/1024<10||(console.log("上传模板大小不能超过 10MB!"),!1)},removeFile:function(t,e){var i=this,s=t;t.response&&t.response.status&&(s=t.response.result),this.api.post("/file/del",s).then(function(e){if(e.status){var s=0;i.fileList.some(function(e,i){return s=i,e._id==t._id}),s<i.fileList.length&&i.fileList.splice(s,1)}})}}},nt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-upload",{staticClass:"upload-demo",attrs:{drag:"",action:"/file/upload",name:"files",accept:".js,.json","file-list":t.files,data:t.chart,onError:t.uploadError,onSuccess:t.uploadSuccess,beforeUpload:t.beforeAvatarUpload,onRemove:t.removeFile,multiple:""}},[i("i",{staticClass:"el-icon-upload"}),t._v(" "),i("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),i("em",[t._v("点击上传")])]),t._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("只能上传js/json文件")])])],1)},staticRenderFns:[]};var at=i("VU/8")(st,nt,!1,function(t){i("b9wK")},"data-v-2a019802",null).exports,rt=i("2Pnh"),ot=i.n(rt),ct={name:"showChart",props:["chart","flag"],data:function(){return{}},mounted:function(){this.init()},methods:{init:function(){this.loadChart()},loadChart:function(){if(this.chart.code){var t=document.createElement("iframe");t.setAttribute("frameborder","0"),t.setAttribute("id","ifr"),document.getElementById("output").innerHTML="",document.getElementById("output").appendChild(t);var e=t.contentWindow?t.contentWindow:t.contentDocument.document?t.contentDocument.document:t.contentDocument;e.document.open(),e.document.write(this.chart.code);var i=this;e.onload=function(){i.chart&&setTimeout(function(){var t;if(t=e.document.getElementsByTagName("svg")[0]){var s=(new XMLSerializer).serializeToString(t);i.chart.base64="data:image/svg+xml;base64,"+window.btoa(s)}else ot()(e.document.querySelector("#container")||e.document.body).then(function(t){i.chart.base64=t.toDataURL("image/png")})},1500)},e.document.close()}}},watch:{flag:function(t,e){this.loadChart()}}},lt={render:function(){this.$createElement;this._self._c;return this._m(0)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",[e("div",{staticClass:"box"}),this._v(" "),e("div",{attrs:{id:"output"}})])}]};var ut=i("VU/8")(ct,lt,!1,function(t){i("hFlI")},"data-v-48741120",null).exports,dt=i("jMz+"),ht=void 0,pt={name:"detail",data:function(){return{id:"",chart:{name:"",project:"",category:"",chartType:"",code:"",base64:""},flag:!1,isFirst:!0,isMove:!1,resource:{serverPath:"http://localhost:8086",lib:{Echarts:[{name:"jquery",url:"//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"},{name:"echarts-v3",url:"//echarts.baidu.com/examples/vendors/echarts/echarts.min.js"},{name:"china",url:"//echarts.baidu.com/examples/vendors/echarts/map/js/china.js"},{name:"world",url:"//echarts.baidu.com/examples/vendors/echarts/map/js/world.js"},{name:"echarts-v2",url:"//cdn.bootcss.com/echarts/2.2.7/echarts-all.js"}],D3:[{name:"jquery",url:"//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"},{name:"d3-v3",url:"//d3js.org/d3.v3.min.js"},{name:"d3-v4",url:"//d3js.org/d3.v4.min.js"}],ThreeJS:[]},staticLib:[],dynamicLib:[],dialogVisible:!1},header:{title:"",id:"",disName:"",isShowPublish:!1},cmOptions:{tabSize:4,styleActiveLine:!0,lineNumbers:!0,line:!0,mode:{name:"htmlmixed",tags:{style:[["type",/^text\/(x-)?scss$/,"text/x-scss"],[null,null,"css"]],custom:[[null,null,"customMode"]]},globalVars:!0},lineWrapping:!1,scrollbarStyle:"simple",theme:"darcula",autoCloseBrackets:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Ctrl-Q":"autocomplete"}}}},computed:o()({},Object(c.b)({user:"getUser",isLogin:"getIsLogin"})),components:{codemirror:G.codemirror,Splitter:J.a,HeaderBar:tt,UploadPage:at,ShowChart:ut},mounted:function(){var t=this;this.init(),window.onresize=function(){t.changeFlag(500)}},methods:{init:function(){var t=this;this.id=this.$route.params.id,this.api.get("/chart/findById",{id:this.id}).then(function(e){t.chart=e.result,t.header.title=t.chart.name,t.header.id=t.chart.user._id,t.header.disName=t.chart.user.disName||t.chart.user.name;var i=t.chart.category||"Echarts";t.resource.staticLib=t.resource.lib[i],t.chart.code||t.api.get("/static/template/"+i+".html").then(function(e){t.chart.code=e}),t.isLogin&&(t.chart.user._id==t.user._id||t.chart.project&&t.user._id==t.chart.project.manager)&&(t.header.isShowPublish=!0)})},save:function(){var t=this;if(this.user)if(this.id){var e={_id:this.id,base64:this.chart.base64,code:this.chart.code,name:this.header.title};this.api.post("/chart/update",e).then(function(e){t.$message({showClose:!0,message:e.status?"图表发布成功":"图表发布失败",type:e.status?"success":"error"})})}else this.$message({showClose:!0,message:"未能获取到图表标识",type:"error"});else this.$message({showClose:!0,message:"登录过期，请重新登录",type:"error"})},spResize:function(){this.changeFlag(500)},onCmReady:function(t){},onCmFocus:function(t){},onCmCodeChange:function(t){this.chart.code=t,this.changeFlag()},changeFlag:function(t){var e=this;ht?Object(L.clearTimeout)(ht):this.isFirst&&(this.flag=!this.flag),this.isFirst||(ht=Object(L.setTimeout)(function(){e.flag=!e.flag},t||1e3)),this.isFirst=!1},getResource:function(){var t=this;this.api.post("/file/find",{chart:this.id}).then(function(e){t.resource.dynamicLib=e.result})},upFiles:function(t){this.resource.dynamicLib.push(t)},uploadResource:function(){this.resource.dialogVisible=!0},run:function(){this.flag=!this.flag},format:function(){var t=dt.html(this.chart.code,{}).replace(/[\n]{2,}/gi,"\n");this.chart.code=t},addResource:function(t){var e="";e=/(\.json)/i.test(t)?"<script>\n  $.get('"+t+"', function(data) {\n  });\n<\/script>":"<script type='text/javascript' src='"+t+"'><\/script>",/(<script)/gi.test(this.chart.code)?this.chart.code=this.chart.code.replace(/(<script)/i,e+"\n$1"):/(<\/body>)/gi.test(this.chart.code)?this.chart.code=this.chart.code.replace(/(<\/body>)/i,"$1\n"+e):this.chart.code+=e}}},mt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("HeaderBar",{attrs:{options:t.header},on:{handleCli:t.save}}),t._v(" "),i("Splitter",{attrs:{margin:20},on:{resize:t.spResize}},[i("div",{attrs:{slot:"left-pane"},slot:"left-pane"},[i("div",{staticClass:"control-panel"},[i("div",{staticClass:"right"},[i("span",{staticClass:"item",attrs:{title:"格式化"},on:{click:t.format}},[i("i",{staticClass:"icon iconfont icon-geshishua"})]),t._v(" "),i("span",{staticClass:"item",attrs:{title:"执行"},on:{click:t.run}},[i("i",{staticClass:"icon iconfont icon-carry-out"})])])]),t._v(" "),i("codemirror",{ref:"myCm",attrs:{value:t.chart.code,options:t.cmOptions},on:{ready:t.onCmReady,focus:t.onCmFocus,input:t.onCmCodeChange}})],1),t._v(" "),i("div",{attrs:{slot:"right-pane"},slot:"right-pane"},[i("ShowChart",{attrs:{chart:t.chart,flag:t.flag}})],1)]),t._v(" "),i("el-dialog",{attrs:{title:"资源管理",visible:t.resource.dialogVisible,width:"700px"},on:{"update:visible":function(e){t.$set(t.resource,"dialogVisible",e)}}},[i("UploadPage",{attrs:{chart:t.chart,fileList:t.resource.dynamicLib},on:{upFiles:t.upFiles}})],1)],1)},staticRenderFns:[]};var ft=i("VU/8")(pt,mt,!1,function(t){i("ulSO")},"data-v-81bd6066",null).exports,vt={name:"userInfo",data:function(){return{sex:1}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){this.init()},methods:{init:function(){this.sex=this.user.sex},save:function(){var t=this;this.user.sex=this.sex,this.api.post("/user/update",this.user).then(function(e){t.$message({showClose:!0,message:e.status?"保存成功":"保存失败,请重新操作",type:e.status?"success":"error"}),e.status&&localStorage.setItem("currUser",n()(t.user))})},reset:function(){}}},gt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t._m(0),t._v(" "),i("div",{staticClass:"baseinfo"},[i("el-form",{attrs:{model:t.user,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"用户名"}},[i("el-input",{attrs:{disabled:""},model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"电话"}},[i("el-input",{model:{value:t.user.tel,callback:function(e){t.$set(t.user,"tel",e)},expression:"user.tel"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"邮箱"}},[i("el-input",{model:{value:t.user.email,callback:function(e){t.$set(t.user,"email",e)},expression:"user.email"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"显示名"}},[i("el-input",{model:{value:t.user.disName,callback:function(e){t.$set(t.user,"disName",e)},expression:"user.disName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"性别"}},[i("el-radio-group",{model:{value:t.sex,callback:function(e){t.sex=e},expression:"sex"}},[i("el-radio",{attrs:{label:1}},[t._v("男")]),t._v(" "),i("el-radio",{attrs:{label:0}},[t._v("女")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.user.remark,callback:function(e){t.$set(t.user,"remark",e)},expression:"user.remark"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title clearfix"},[e("h2",[e("i",{staticClass:"icon iconfont icon-icon-yuanxk"}),this._v("基本信息")])])}]};var _t=i("VU/8")(vt,gt,!1,function(t){i("VGf4")},"data-v-e891e0dc",null).exports,bt={name:"userInfo",data:function(){var t=this;return{ruleForm:{oldPwd:"",pwd:"",checkPwd:""},rules:{oldPwd:[{validator:function(e,i,s){""===i?s(new Error("请输入原始密码")):t.api.post("/user/find",{_id:t.user._id,pwd:i}).then(function(t){t.result?s():s(new Error("原始密码错误，请重新输入"))})},trigger:"blur"}],pwd:[{validator:function(t,e,i){""===e?i(new Error("请输入密码")):e.length<6?i(new Error("请设置不少于6为的密码长度")):i()},trigger:"blur"}],checkPwd:[{validator:function(e,i,s){""===i?s(new Error("请再次输入密码")):i!==t.ruleForm.pwd?s(new Error("两次输入密码不一致!")):s()},trigger:"blur"}]}}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){this.init()},methods:{init:function(){},change:function(){var t=this;this.$refs.ruleForm.validate(function(e){if(!e)return console.log("error submit!!"),!1;var i={_id:t.user._id,pwd:t.ruleForm.pwd};t.api.post("/user/update",i).then(function(e){t.$message({showClose:!0,message:e.status?"密码修改成功":"修改失败,请重新操作",type:e.status?"success":"error"})})})},reset:function(){}}},Ct={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t._m(0),t._v(" "),i("div",{staticClass:"baseinfo"},[i("el-form",{ref:"ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"用户名"}},[i("el-input",{attrs:{disabled:""},model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"原始密码",prop:"oldPwd"}},[i("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.oldPwd,callback:function(e){t.$set(t.ruleForm,"oldPwd",e)},expression:"ruleForm.oldPwd"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"新密码",prop:"pwd"}},[i("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.pwd,callback:function(e){t.$set(t.ruleForm,"pwd",e)},expression:"ruleForm.pwd"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"确认密码",prop:"checkPwd"}},[i("el-input",{attrs:{type:"password"},model:{value:t.ruleForm.checkPwd,callback:function(e){t.$set(t.ruleForm,"checkPwd",e)},expression:"ruleForm.checkPwd"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.change}},[t._v("修改")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title clearfix"},[e("h2",[e("i",{staticClass:"icon iconfont icon-mima1"}),this._v("修改密码")])])}]};var yt=i("VU/8")(bt,Ct,!1,function(t){i("qpt2")},"data-v-4f53c374",null).exports,wt={name:"autocomplete",props:["project"],data:function(){return{isActive:!1}},computed:o()({},Object(c.b)({user:"getUser"})),methods:{showAddInput:function(){this.isActive=!0},querySearchAsync:function(t,e){t&&this.api.get("/user/find2",{keyword:t}).then(function(t){0==t.result.length?e([{name:"请更换关键字",_id:-1}]):e(t.result)})},handleSelect:function(t){var e=this;if(t&&-1!=t._id){var i=this.project;i.members||(i.members=[]),i.members.some(function(e){return e._id==t._id})||(i.members.push(t),this.api.post("/project/edit",i).then(function(t){t.status||e.$message({showClose:!0,message:"添加失败，请刷新列表",type:"error"})}))}}}},xt={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{class:["add-member",this.isActive?"active":""]},[e("i",{staticClass:"icon iconfont icon-tianjiakehu",attrs:{title:"添加成员"},on:{click:this.showAddInput}}),this._v(" "),e("el-autocomplete",{attrs:{size:"mini","fetch-suggestions":this.querySearchAsync,"trigger-on-focus":!1,"select-when-unmatched":!1,valueKey:"name",placeholder:"请输入用户名...."},on:{select:this.handleSelect}})],1)},staticRenderFns:[]};var kt=i("VU/8")(wt,xt,!1,function(t){i("GfIb")},"data-v-5b83fd12",null).exports,jt={name:"index",data:function(){return{loading:!1,pagination:{index:1,size:10,total:0},changePage:{prev:"上一页",next:"下一页"},proList:[],proRelChart:[],dialog:{visible:!1,title:"添加项目"},proItem:[]}},computed:o()({},Object(c.b)({user:"getUser"})),components:{AddProject:B,Autocomplete:kt},mounted:function(){this.init()},methods:{init:function(){this.getProRelChartCount()},getProRelChartCount:function(){var t=this;this.loading=!0,this.api.get("/project/chartCount").then(function(e){e.status&&(t.proRelChart=e.result),t.getProCount()})},getProCount:function(){var t=this,e=this.user.superAdmin?{}:{userId:this.user._id};this.api.get("/project/count",e).then(function(e){e.status&&(t.pagination.total=e.result),t.getProjects()})},getProjects:function(){var t=this,e={pageIndex:this.pagination.index-1,pageSize:this.pagination.size};this.user.superAdmin||(e.userId=this.user._id),this.api.post("/project/findByUser",e).then(function(e){e.status&&(t.proList=e.result),t.loading=!1})},getChartCount:function(t){var e=void 0;return this.proRelChart.some(function(i,s,n){if(i._id==t)return e=i,!0}),e?e.count:"0"},addProject:function(){this.reset(),this.dialog.title="添加项目",this.dialog.visible=!0},handleEdit:function(t){this.proItem={_id:t._id,name:t.name,createDate:t.createDate,remark:t.remark},this.dialog.title="编辑项目",this.dialog.visible=!0},handleDelete:function(t){var e=this;this.getChartCount(t)>0?this.$alert("项目下存在图表，请先移除图表","提示",{confirmButtonText:"确定"}):this.api.post("/project/del",{_id:t}).then(function(t){e.$message({showClose:!0,message:t.status?"删除成功":"删除失败",type:t.status?"success":"error"}),e.reload()})},handleSizeChange:function(t){this.pagination.size=t,this.getProjects()},handleCurrentChange:function(t){this.pagination.index=t,this.getProjects()},removeMember:function(t,e,i){var s=this;e.members.splice(t,1),this.api.post("/project/edit",e).then(function(t){t.status?i&&s.reload():s.$message({showClose:!0,message:"操作失败，请刷新页面",type:"error"})})},reload:function(){this.dialog.visible=!1,this.pagination.index=1,this.getProRelChartCount(),l.setProjects(this,this.user)},reset:function(){this.proItem={name:"",remark:""}}},watch:{},filters:{formatDate:function(t){var e=new Date(t);return l.formatDate(e,"yyyy-MM-dd hh:mm")}}},$t={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[i("div",{staticClass:"title clearfix"},[t._m(0),t._v(" "),i("div",{staticClass:"operate"},[i("el-button",{attrs:{size:"mini",icon:"icon iconfont icon-tianjia"},on:{click:t.addProject}},[t._v(" 添加")]),t._v(" "),i("el-button",{attrs:{size:"mini",icon:"icon iconfont icon-shuaxin"},on:{click:t.reload}},[t._v(" 刷新")])],1)]),t._v(" "),i("div",{staticClass:"list"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.proList}},[i("el-table-column",{attrs:{type:"expand"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticClass:"pro-member-con"},[t.user.superAdmin||e.row.manager&&e.row.manager._id==t.user._id?i("Autocomplete",{attrs:{project:e.row}}):t._e(),t._v(" "),i("div",[i("label",[t._v("项目成员：")]),t._v(" "),e.row.manager?i("div",{staticClass:"member manager",attrs:{title:"管理员"}},[i("i",{staticClass:"icon iconfont icon-guanliyuan"}),t._v(" "),i("span",[t._v(t._s(e.row.manager.name))])]):t._e(),t._v(" "),t._l(e.row.members,function(s,n){return i("div",{staticClass:"member",attrs:{title:"项目成员"}},[i("i",{staticClass:"icon iconfont icon-yonghu"}),t._v(" "),i("span",[t._v(t._s(s.name))]),t._v(" "),t.user.superAdmin||e.row.manager&&e.row.manager._id==t.user._id?i("i",{staticClass:"icon iconfont icon-shanchu1",attrs:{title:"踢出"},on:{click:function(i){t.removeMember(n,e.row)}}}):t.user._id==s._id?i("i",{staticClass:"icon iconfont icon-tuichu1",attrs:{title:"退出"},on:{click:function(i){t.removeMember(n,e.row,!0)}}}):t._e()])})],2)],1)]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"项目名称",prop:"name"}}),t._v(" "),i("el-table-column",{attrs:{label:"创建日期"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t._f("formatDate")(e.row.createDate))+"\n        ")]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"我发起的项目"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.manager&&t.user._id==e.row.manager._id?i("i",{staticClass:"icon iconfont icon-duigou"}):t._e()]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"图表数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.getChartCount(e.row._id))+"\n        ")]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("span",{staticClass:"operate",on:{click:function(i){t.handleEdit(e.row)}}},[i("i",{staticClass:"icon iconfont icon-bianji"}),t._v("编辑")]),t._v(" "),t.user.superAdmin||e.row.manager&&t.user._id==e.row.manager._id?i("span",{staticClass:"operate",on:{click:function(i){t.handleDelete(e.row._id)}}},[i("i",{staticClass:"icon iconfont icon-shanchu1"}),t._v("删除")]):t._e()]}}])})],1)],1),t._v(" "),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"","current-page":t.pagination.index,"page-size":t.pagination.size,layout:"total, prev, pager, next, jumper",total:t.pagination.total,"prev-text":t.changePage.prev,"next-text":t.changePage.next},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),i("el-dialog",{attrs:{title:t.dialog.title,visible:t.dialog.visible,width:"60%","lock-scroll":!1},on:{"update:visible":function(e){t.$set(t.dialog,"visible",e)}}},[i("AddProject",{attrs:{proItem:t.proItem},on:{reloadProject:t.reload}})],1)],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("h2",[e("i",{staticClass:"icon iconfont icon-msnui-item-list"}),this._v("项目列表")])}]};var It={name:"user",data:function(){return{currentView:"BaseInfo",menus:[{name:"用户基本信息",flag:"BaseInfo",icon:"icon-yonghu1"},{name:"修改密码",flag:"UserPwd",icon:"icon-mima"},{name:"我的项目",flag:"Project",icon:"icon-xiangmu"}]}},components:{BaseInfo:_t,UserPwd:yt,Project:i("VU/8")(jt,$t,!1,function(t){i("4L0j")},"data-v-d485ce4c",null).exports,HeaderBar:F},mounted:function(){this.init()},methods:{init:function(){this.$store.dispatch("setCurrMenu",{flag:""})},changeMenu:function(t){this.currentView=t.flag}}},Pt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("HeaderBar"),t._v(" "),i("div",{staticClass:"left-bar"},[i("ul",t._l(t.menus,function(e){return i("el-tooltip",{key:e.flag,staticClass:"item",attrs:{effect:"dark",content:e.name,placement:"right"}},[i("li",{class:[t.currentView===e.flag?"active":""],on:{click:function(i){t.changeMenu(e)}}},[i("i",{class:["icon","iconfont",e.icon]})])])}))]),t._v(" "),i("div",{staticClass:"right-page"},[i(t.currentView,{tag:"component"})],1)],1)},staticRenderFns:[]};var St=i("VU/8")(It,Pt,!1,function(t){i("tHOV")},"data-v-01638584",null).exports,Ft={name:"addUser",data:function(){return{user:{name:"",pwd:"",tel:"",email:"",sex:1,disName:"",remark:""}}},computed:o()({},Object(c.b)({user:"getUser"})),mounted:function(){},methods:{init:function(){},save:function(){var t=this;this.api.post("/user/add",this.user).then(function(e){if(e.status){var i={name:"临时项目",manager:e.result};t.api.post("/project/add",i).then(function(e){t.$message({showClose:!0,message:e.status?"添加成功":"添加失败,请重新操作",type:e.status?"success":"error"})})}else t.$message({showClose:!0,message:"添加失败,请重新操作",type:"error"})})},reset:function(){}}},Lt={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"container"},[t._m(0),t._v(" "),i("div",{staticClass:"baseinfo"},[i("el-form",{attrs:{model:t.user,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"用户名"}},[i("el-input",{model:{value:t.user.name,callback:function(e){t.$set(t.user,"name",e)},expression:"user.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"密码"}},[i("el-input",{model:{value:t.user.pwd,callback:function(e){t.$set(t.user,"pwd",e)},expression:"user.pwd"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"电话"}},[i("el-input",{model:{value:t.user.tel,callback:function(e){t.$set(t.user,"tel",e)},expression:"user.tel"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"邮箱"}},[i("el-input",{model:{value:t.user.email,callback:function(e){t.$set(t.user,"email",e)},expression:"user.email"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"显示名"}},[i("el-input",{model:{value:t.user.disName,callback:function(e){t.$set(t.user,"disName",e)},expression:"user.disName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"性别"}},[i("el-radio-group",{model:{value:t.sex,callback:function(e){t.sex=e},expression:"sex"}},[i("el-radio",{attrs:{label:1}},[t._v("男")]),t._v(" "),i("el-radio",{attrs:{label:0}},[t._v("女")])],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"备注"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.user.remark,callback:function(e){t.$set(t.user,"remark",e)},expression:"user.remark"}})],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:t.save}},[t._v("保存")])],1)],1)],1)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"title clearfix"},[e("h2",[e("i",{staticClass:"icon iconfont icon-icon-yuanxk"}),this._v("添加用户")])])}]};var Tt=i("VU/8")(Ft,Lt,!1,function(t){i("8idx")},"data-v-6c5b45c6",null).exports,Et={data:function(){return{ruleForm:{username:"",password:""},rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]}}},components:{},created:function(){var t=this.getUrlData("code")||"";""!=t&&(console.log("code:",t),this.api.get("/github/user_info",{code:t}).then(function(t){console.log("response:",t)},function(t){}))},methods:{submitForm:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return e.$router.push("/table1"),!1;e.$router.push("/table1")})},githubClick:function(){window.location.href="https://github.com/login/oauth/authorize?client_id=263f45ba8ea1fb856276&redirect_uri=http://localhost:8085/#/login"},getUrlData:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(e);return null!=i?unescape(i[2]):null}}},Ut={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"login"},[i("div",{staticClass:"login-title"},[t._v("图表配置系统")]),t._v(" "),i("div",{staticClass:"login-form"},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:t.ruleForm,rules:t.rules,"label-width":"0px"}},[i("el-form-item",{attrs:{prop:"username"}},[i("el-input",{attrs:{placeholder:"username"},model:{value:t.ruleForm.username,callback:function(e){t.$set(t.ruleForm,"username",e)},expression:"ruleForm.username"}})],1),t._v(" "),i("el-form-item",{attrs:{prop:"password"}},[i("el-input",{attrs:{type:"password",placeholder:"password"},nativeOn:{keyup:function(e){if(!("button"in e)&&t._k(e.keyCode,"enter",13,e.key,"Enter"))return null;t.submitForm("ruleForm")}},model:{value:t.ruleForm.password,callback:function(e){t.$set(t.ruleForm,"password",e)},expression:"ruleForm.password"}})],1),t._v(" "),i("div",{staticClass:"login-btn"},[i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitForm("ruleForm")}}},[t._v("登录")])],1),t._v(" "),i("i",{staticClass:"icon iconfont icon-github",on:{click:t.githubClick}})],1)],1)])},staticRenderFns:[]};var Dt=i("VU/8")(Et,Ut,!1,function(t){i("KwuY")},"data-v-32980e8b",null).exports;a.default.use(g.a);var Rt=new g.a({mode:"history",routes:[{path:"/",name:"PageApp",component:b,children:[{path:"",name:"index",component:K},{path:"chart/:type",name:"chart",component:K},{path:"user",name:"user",component:St,beforeEnter:function(t,e,i){i()}},{path:"addUser",name:"addUser",component:Tt},{path:"login",name:"login",component:Dt}]},{path:"/detail/:id",name:"Detail",component:ft}]}),Bt={base:[{name:"类型导航",flag:"charttype",url:"/chart/type",icon:"icon-zhuzhuangtu1"}],person:[{name:"项目导航",flag:"chartpro",url:"/chart/pro",icon:"icon-weibiaoti2010103-copy"}]},Mt={state:{menus:Bt.base,currMenu:Bt.base[0]},mutations:{setCurrMenu:function(t,e){t.currMenu=e},setMenus:function(t,e){t.menus=e}},actions:{setCurrMenu:function(t,e){t.commit("setCurrMenu",e)},setMenus:function(t,e){t.commit("setMenus",e?[].concat(w()(Bt.base),w()(Bt.person)):Bt.base)}},getters:{getCurrMenu:function(t){return t.currMenu},getMenus:function(t){return t.menus}}},zt={state:{isLogin:!1,showLoginDialog:!1,user:null},mutations:{setLoginDialogState:function(t,e){t.showLoginDialog=e},setIsLogin:function(t,e){t.isLogin=e},setUser:function(t,e){t.user=e}},actions:{setLoginDialogState:function(t,e){t.commit("setLoginDialogState",e)},setIsLogin:function(t,e){t.commit("setIsLogin",e)},setUser:function(t,e){t.commit("setUser",e),t.commit("setIsLogin",!!e)}},getters:{getIsShowLoginDialog:function(t){return t.showLoginDialog},getIsLogin:function(t){return t.isLogin},getUser:function(t){return t.user&&delete t.user.pwd,t.user},getTestNums:function(t){return t.testNums}}},At={state:{projects:[],types:[]},mutations:{setProjects:function(t,e){t.projects=e},setTypes:function(t,e){t.types=e}},actions:{setProjects:function(t,e){t.commit("setProjects",e)},setTypes:function(t,e){context.commit("setTypes",e)}},getters:{getProjects:function(t){return t.projects},getTypes:function(t){return t.types}}};a.default.use(c.a);var Vt=new c.a.Store({modules:{menu:Mt,user:zt,chart:At},strict:!1}),Nt=i("//Fk"),Ot=i.n(Nt),qt=i("mtWM"),Ht=i.n(qt);Ht.a.defaults.timeout=5e4,Ht.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8";var Yt=Ht.a.create({}),Kt={post:function(t,e){return new Ot.a(function(i,s){Yt.post(""+t,e).then(function(t){i(t.data)}).catch(function(t){s(t)})})},get:function(t,e){return new Ot.a(function(i,s){Yt.get(""+t,{params:e}).then(function(t){i(t.data)}).catch(function(t){s(t)})})}};i("/wAz"),i("tvR6"),i("m5D7"),i("991W"),i("oikB");a.default.config.productionTip=!1,a.default.prototype.api=Kt,a.default.use(N.a),a.default.use(W.a),new a.default({el:"#app",router:Rt,store:Vt,created:function(){var t=this,e=localStorage.getItem("currUser");if(e){var i=JSON.parse(e);l.setLoginStore(this,i)}else{var s=l.getUrlData("code")||"";if(!s)return;Kt.get("/github/user_info",{code:s}).then(function(e){if(e.status){var i=e.result;console.log("gitUser:",i),Kt.post("/user/github_login",{login:i.login,name:i.name,email:i.email}).then(function(e){e.status&&(localStorage.setItem("currUser",n()(e.result)),l.setLoginStore(t,e.result)),l.message(t,e.status?"success":"error",e.status?"登录成功":"登录失败")})}else l.message(t,"error",e.result.msg)})}},render:function(t){return t(v)}})},PsxY:function(t,e){},VGf4:function(t,e){},Yokd:function(t,e){},b72d:function(t,e){},b9wK:function(t,e){},"bF7+":function(t,e){},hFlI:function(t,e){},iVNi:function(t,e){},m5D7:function(t,e){},oikB:function(t,e){},qpBq:function(t,e){},qpt2:function(t,e){},tHOV:function(t,e){},tvR6:function(t,e){},ulSO:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.73d091946f36dcd000cf.js.map